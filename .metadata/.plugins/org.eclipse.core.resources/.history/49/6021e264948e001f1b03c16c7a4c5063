/*
 * stopWatch.c
 *
 *  Created on: Oct 19, 2024
 *      Author: ckck
 */

#include "stopWatch.h"
#include "defines.h"

stopWatch swState = {STOP, {0, 0, 0, 0}};
uint8_t PC15_State;
uint8_t PD4_State;
uint8_t seg_flag;
uint8_t blue_led_flag;
uint8_t PD4_sw_flag;



void segUpCount() {
	if(!seg_flag) {
		swState.time.hour = 0;
		swState.time.minute = 0;
		swState.time.second = 0;
		swState.time.millisecond = 0;
	}
	if(millisecond < 500) {
		_7SEG_SetNumber(DGT1, swState.time.second % 10, 1);
	} else {
		_7SEG_SetNumber(DGT1, swState.time.second % 10, 0);
	}
	_7SEG_SetNumber(DGT2, swState.time.millisecond / 100, 0);

}

void saveTime() {

	if(swState.time.millisecond % 1000 == 0) {
		swState.time.millisecond = 0;
		swState.time.second++;
	}
	if(swState.time.second == 60) {
		swState.time.second = 0;
		swState.time.minute++;
	}
	if(swState.time.minute == 60) {
		swState.time.minute = 0;
		swState.time.hour++;
	}
	if(swState.time.hour == 24) {
		swState.time.hour = 0;
	}
}

void sw2StopWatchControll() {
	// SW2 PC15, PD13
	if (PC15_State) {
		swState.state = RUN;
		if(swState.state == PAUSE || swState.state == STOP) {
			swState.state = RUN;
			segUpCount();
			seg_flag = 1;
		} else if(swState.state == RUN) {
			swState.state == PAUSE;
		}
	} else if(!PC15_State && stopWatchActionState == 1) {
		stopWatchActionState = 2;
	}
}

void sw3StopWatchReset() {
	// SW3 PD4, PD14
	if(PD4_State) {
		if(stopWatchActionState == 2 || stopWatchActionState == 0) {
//			if (PD4_State != blue_led_flag) {
//				blue_led_flag = !blue_led_flag;
//				if (blue_led_flag) {
//					if (HAL_GPIO_ReadPin(GPIOD, GPIO_PIN_14)) {
//						HAL_GPIO_WritePin(GPIOD, GPIO_PIN_14, 0);
//					} else {
//						HAL_GPIO_WritePin(GPIOD, GPIO_PIN_14, 1);
//					}
//
//				}
//			}
			seg_flag = 0;
			stopWatchActionState = 0;
			_7SEG_SetNumber(DGT1, 0, 1);
			_7SEG_SetNumber(DGT2, 0, 0);
//			sw3LEDBlueToggle();

		}
	}
}
