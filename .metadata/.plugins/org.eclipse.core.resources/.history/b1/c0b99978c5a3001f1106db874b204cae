/*
 * alarm.c
 *
 *  Created on: Nov 14, 2024
 *      Author: ckck
 */
#include "alarm.h"

extern clockSt clock;
extern modeSelector mode;
alarmSt alarm = {{{0, 0, 1}, {1, 1, 0}, {1, 1, 0}, {1, 1, 0}, {1, 1, 0}}, 0, 0};


void selectAlarm() {	// sw2 기능 알람 선택
	if(alarm.select >= ((sizeof(alarm) - 2) / 3) - 1) { // 알람 구조체안에 set 구조체5개의 길이 - 1
		alarm.select = 0;
	} else {
		alarm.select++;
	}
}

void alarmTrigger() {	// 알람 울림
	if(alarm.triggerd == TRUE) {
		 playAlram();
	} else {
		for(int i = 0; i < (sizeof(alarm) - 2) / 3; i++) {	// 5번 동작
			if(alarm.set[i].enabled == TRUE) {	// 알람 활성화 확인
				if(alarm.set[i].hour == clock.hour &&	// 알람 설정 시간의 0초, 0밀리초 될 때 알람 온
					alarm.set[i].minute == clock.minute &&
					clock.second == 0 && clock.millisecond == 0) {
					mode = ALARM_TRIGGER;
					alarm.triggerd = 1;
				}
			}
		}
	}
}

void returnToPreviousMode() {

}
uint8_t getTriggerd() {
	return alarm.triggerd;
}

void setTriggerd(uint8_t set) {
	alarm.triggerd = set;
}

uint8_t getSelect() {
	return alarm.select;
}

void setSelect(uint8_t s) {
	alarm.select = s;
}
uint8_t getAlarmEnabled(int num) {
	return alarm.set[num].enabled;
}
void setAlarmEnabled(uint8_t enabled, int num) {
	alarm.set[num].enabled = enabled;
}
